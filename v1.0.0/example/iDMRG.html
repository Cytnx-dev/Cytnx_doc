<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Common usage" href="../CommApp.html" /><link rel="prev" title="3. DMRG" href="DMRG.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>4. iDMRG - Cytnx documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Cytnx  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/Iconi.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Cytnx  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../Intro.html">Introduction</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../install.html">Install &amp; Usage of Cytnx</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Install &amp; Usage of Cytnx</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../adv_install.html">Advanced Install of Cytnx</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Advanced Install of Cytnx</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../convention.html">Function Naming convention</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Function Naming convention</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Guide.html">User Guide</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of User Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../guide/behavior.html">1. Objects behavior</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 1. Objects behavior</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guide/Device.html">2. Device</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../guide/basic_obj/Tensor.html">3. Tensor</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 3. Tensor</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/basic_obj/Tensor_1_create.html">3.1. Creating a Tensor</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of 3.1. Creating a Tensor</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/basic_obj/Tensor_2_manip.html">3.2. Manipulating Tensors</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of 3.2. Manipulating Tensors</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/basic_obj/Tensor_3_access.html">3.3. Accessing elements</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 3.3. Accessing elements</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/basic_obj/Tensor_4_arithmetic.html">3.4. Tensor arithmetic</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 3.4. Tensor arithmetic</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/basic_obj/Tensor_5_numpy.html">3.5. To/From numpy.array</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of 3.5. To/From numpy.array</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/basic_obj/Tensor_6_app.html">3.6. Appending elements</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of 3.6. Appending elements</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/basic_obj/Tensor_7_io.html">3.7. Save/Load a Tensor</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of 3.7. Save/Load a Tensor</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/basic_obj/Tensor_8_cp.html">3.8. When will data be copied?</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of 3.8. When will data be copied?</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../guide/basic_obj/Storage.html">4. Storage</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of 4. Storage</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/basic_obj/Storage_1_create.html">4.1. Creating a Storage</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of 4.1. Creating a Storage</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/basic_obj/Storage_2_access.html">4.2. Accessing elements</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of 4.2. Accessing elements</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/basic_obj/Storage_3_expand.html">4.3. Increase size</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of 4.3. Increase size</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/basic_obj/Storage_4_vec.html">4.4. From/To C++.vector</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of 4.4. From/To C++.vector</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/basic_obj/Storage_5_io.html">4.5. Save/Load a storage</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of 4.5. Save/Load a storage</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../guide/basic_obj/Scalar.html">5. Scalar</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of 5. Scalar</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../guide/TNotation.html">6. Tensor notation</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of 6. Tensor notation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../guide/uniten.html">7. UniTensor</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of 7. UniTensor</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/uniten/print.html">7.1. Print and display</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/uniten/create.html">7.2. Creating a UniTensor</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/uniten/labels.html">7.3. Changing labels</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of 7.3. Changing labels</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/uniten/bond.html">7.4. Bond</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle navigation of 7.4. Bond</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/uniten/tagged.html">7.5. Tagged UniTensor</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle navigation of 7.5. Tagged UniTensor</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/uniten/symmetric.html">7.6. UniTensor with Symmetries</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle navigation of 7.6. UniTensor with Symmetries</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/uniten/blocks.html">7.7. Accessing the block(s)</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><div class="visually-hidden">Toggle navigation of 7.7. Accessing the block(s)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/uniten/elements.html">7.8. Get/set UniTensor element</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><div class="visually-hidden">Toggle navigation of 7.8. Get/set UniTensor element</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/uniten/manipulation.html">7.9. Manipulate UniTensor</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/uniten/io.html">7.10. Save/Load a UniTensor</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><div class="visually-hidden">Toggle navigation of 7.10. Save/Load a UniTensor</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../guide/contraction.html">8. Contraction</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><div class="visually-hidden">Toggle navigation of 8. Contraction</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/contraction/network.html">8.1. Network</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><div class="visually-hidden">Toggle navigation of 8.1. Network</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/contraction/contract.html">8.2. Contract(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/contraction/ncon.html">8.3. ncon</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../guide/linalg.html">9. Linear algebra</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><div class="visually-hidden">Toggle navigation of 9. Linear algebra</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../guide/itersol.html">10. Iterative solver</a><input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><div class="visually-hidden">Toggle navigation of 10. Iterative solver</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../guide/itersol/LinOp.html">10.1. LinOp class</a><input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><div class="visually-hidden">Toggle navigation of 10.1. LinOp class</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/itersol/Lanczos.html">10.2. Lanczos solver</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../guide/xlinalg.html">11. linalg extension</a><input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><div class="visually-hidden">Toggle navigation of 11. linalg extension</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guide/common.html">12. Common APIs</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../Examples.html">Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" role="switch" type="checkbox"/><label for="toctree-checkbox-37"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ED.html">1. Exact Diagonalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="iTEBD.html">2. iTEBD</a></li>
<li class="toctree-l2"><a class="reference internal" href="DMRG.html">3. DMRG</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">4. iDMRG</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../CommApp.html">Common usage</a><input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" role="switch" type="checkbox"/><label for="toctree-checkbox-38"><div class="visually-hidden">Toggle navigation of Common usage</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../common_app/SymUT_fill.html">1. Set same value for all blocks in UniTensor with Symmetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_app/BlasINT.html">2. Check current Blas/Lapack integer size</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Perf_tune.html">Performance tuning</a><input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" role="switch" type="checkbox"/><label for="toctree-checkbox-39"><div class="visually-hidden">Toggle navigation of Performance tuning</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../perf_tune/tensordot.html">Tensordot with input cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../perf_tune/tensorelem.html">Access single element of Tensor in C++</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://kaihsinwu.gitlab.io/cytnx_api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/kaihsin/Cytnx">Github</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1vuc_fTbwkL5t52glzvJ0nNRLPZxj5en6/view?usp=sharing">5-mins Blitz intro slide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Developer.html">Developer</a></li>
</ul>

</div>
<div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Branches</span></p>
  <ul>
  </ul>
  <p class="caption" role="heading"><span class="caption-text">Tags</span></p>
  <ul>
    <li class="toctree-l1"><a class="reference" href="iDMRG.html">v1.0.0</a></li>
  </ul>
</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/example/iDMRG.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="idmrg">
<h1><span class="section-number">4. </span>iDMRG<a class="headerlink" href="#idmrg" title="Link to this heading">¶</a></h1>
<p><strong>By : Hsu Ke, Kai-Hsin Wu</strong></p>
<p>In the previous example we demostrated how the finite size DMRG is implemented,
Here we present the infinite system size DMRG (iDMRG) scheme which consider the system with <em>infinite boundary condition</em><span id="id1">[<a class="reference internal" href="#id3" title="Ho N. Phien, Guifré Vidal, and Ian P. McCulloch. Infinite boundary conditions for matrix product state calculations. Phys. Rev. B, 86:245107, Dec 2012. URL: https://link.aps.org/doi/10.1103/PhysRevB.86.245107, doi:10.1103/PhysRevB.86.245107.">PVM12</a>]</span>,
where the bondaries (enviroments) are grows the lattice by one or more sites each iteration,
at the fixed point, a translationally invariant wavefunction is produced.</p>
<p>In another algorithm of infinite size simulation, iTEBD, a properly converged state requires careful scaling of the time-step to zero,
a DMRG approach where an efficient local eigensolver is used to find a variationally optimal state ought to be much more robust and efficient.
There are also disadavatages for iDMRG, we recommend the interested reader to refer to the paper of iDMRG or benchmarks made in the relevant papers.</p>
<p>Here, we use a 1D transverse field Ising model (TFIM) as a simple example to show how to implement iDMRG algorithm in Cytnx and get the infinite system size (variational) ground state.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[H = J\sum_{ij} \sigma^{z}_i\sigma^{z}_j - H_x\sum_i \sigma^{x}_i\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(\sigma^{x,z}\)</span> are the pauli matrices.
The infinite size ground state can be represent by MPS as variational ansatz, refer to the previous examples.</p>
<p>The MPO is constucted as following:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}   M_j = \begin{bmatrix}
I &amp; S^z_j&amp; H_x S^x_j \\
0 &amp; 0 &amp; S^z_j \\
0 &amp; 0 &amp; I  \end{bmatrix}\end{split}\]</div>
</div>
<p>with the left and right boundary:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\begin{split}L = \begin{bmatrix} 1\\ 0\\ 0 \end{bmatrix}\end{split}\\\begin{split}R = \begin{bmatrix} 0\\ 0\\ 1 \end{bmatrix}\end{split}\end{aligned}\end{align} \]</div>
</div>
<section id="initialization">
<h2><span class="section-number">4.1. </span>Initialization<a class="headerlink" href="#initialization" title="Link to this heading">¶</a></h2>
<p>The initailzation of MPO is much the same as we did in the previous DMRG example:</p>
<ul class="simple">
<li><p>In Python:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">J</span>  <span class="o">=</span> <span class="mf">1.0</span>
<span class="linenos"> 2</span><span class="n">Hx</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="n">d</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos"> 5</span><span class="n">sx</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">pauli</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="p">()</span>
<span class="linenos"> 6</span><span class="n">sz</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">pauli</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="p">()</span>
<span class="linenos"> 7</span><span class="n">eye</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="linenos"> 8</span><span class="n">M</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">d</span><span class="p">])</span>
<span class="linenos"> 9</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">eye</span>
<span class="linenos">10</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sz</span>
<span class="linenos">11</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Hx</span><span class="o">*</span><span class="n">sx</span>
<span class="linenos">12</span><span class="n">M</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">UniTensor</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">rowrank</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="n">L0</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">UniTensor</span><span class="p">(</span><span class="n">cytnx</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">rowrank</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#Left boundary</span>
<span class="linenos">15</span><span class="n">R0</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">UniTensor</span><span class="p">(</span><span class="n">cytnx</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">rowrank</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#Right boundary</span>
<span class="linenos">16</span><span class="n">L0</span><span class="o">.</span><span class="n">get_block_</span><span class="p">()[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span> <span class="n">R0</span><span class="o">.</span><span class="n">get_block_</span><span class="p">()[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">L</span> <span class="o">=</span> <span class="n">L0</span>
<span class="linenos">19</span><span class="n">R</span> <span class="o">=</span> <span class="n">R0</span>
</pre></div>
</div>
</section>
<section id="update-procedure">
<h2><span class="section-number">4.2. </span>Update procedure<a class="headerlink" href="#update-procedure" title="Link to this heading">¶</a></h2>
<p>The first step of iDMRG is to obtain a initial two-site state, which is done by solving the eigenvalue problem of two-site hamitonian:</p>
<a class="reference internal image-reference" href="../_images/idmrg_n0.png"><img alt="../_images/idmrg_n0.png" class="align-center" src="../_images/idmrg_n0.png" style="width: 600px;" />
</a>
<p>Let’s implement the function solving eigenvalue problem using in-built Lanczos method and the needed linear operation class:</p>
<ul class="simple">
<li><p>In Python:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span><span class="w"> </span><span class="nc">Projector</span><span class="p">(</span><span class="n">cytnx</span><span class="o">.</span><span class="n">LinOp</span><span class="p">):</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">M1</span><span class="p">,</span><span class="n">M2</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">psi_dim</span><span class="p">,</span><span class="n">psi_dtype</span><span class="p">,</span><span class="n">psi_device</span><span class="p">):</span>
<span class="linenos"> 5</span>        <span class="n">cytnx</span><span class="o">.</span><span class="n">LinOp</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;mv&quot;</span><span class="p">,</span><span class="n">psi_dim</span><span class="p">,</span><span class="n">psi_dtype</span><span class="p">,</span><span class="n">psi_device</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>        <span class="bp">self</span><span class="o">.</span><span class="n">anet</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s2">&quot;projector.net&quot;</span><span class="p">)</span>
<span class="linenos"> 8</span>        <span class="bp">self</span><span class="o">.</span><span class="n">anet</span><span class="o">.</span><span class="n">PutUniTensor</span><span class="p">(</span><span class="s2">&quot;M2&quot;</span><span class="p">,</span><span class="n">M2</span><span class="p">)</span>
<span class="linenos"> 9</span>        <span class="bp">self</span><span class="o">.</span><span class="n">anet</span><span class="o">.</span><span class="n">PutUniTensors</span><span class="p">([</span><span class="s2">&quot;L&quot;</span><span class="p">,</span><span class="s2">&quot;M1&quot;</span><span class="p">,</span><span class="s2">&quot;R&quot;</span><span class="p">],[</span><span class="n">L</span><span class="p">,</span><span class="n">M1</span><span class="p">,</span><span class="n">R</span><span class="p">])</span>
<span class="linenos">10</span>        <span class="bp">self</span><span class="o">.</span><span class="n">psi_shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">L</span><span class="o">.</span><span class="n">shape</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span><span class="n">M1</span><span class="o">.</span><span class="n">shape</span><span class="p">()[</span><span class="mi">2</span><span class="p">],</span><span class="n">M2</span><span class="o">.</span><span class="n">shape</span><span class="p">()[</span><span class="mi">2</span><span class="p">],</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">()[</span><span class="mi">1</span><span class="p">]]</span>
<span class="linenos">11</span>
<span class="linenos">12</span>    <span class="k">def</span><span class="w"> </span><span class="nf">matvec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">psi</span><span class="p">):</span>
<span class="linenos">13</span>
<span class="linenos">14</span>        <span class="n">psi_p</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">UniTensor</span><span class="p">(</span><span class="n">psi</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span><span class="n">rowrank</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1">## clone here</span>
<span class="linenos">15</span>        <span class="n">psi_p</span><span class="o">.</span><span class="n">reshape_</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">psi_shape</span><span class="p">)</span>
<span class="linenos">16</span>
<span class="linenos">17</span>        <span class="bp">self</span><span class="o">.</span><span class="n">anet</span><span class="o">.</span><span class="n">PutUniTensor</span><span class="p">(</span><span class="s2">&quot;psi&quot;</span><span class="p">,</span><span class="n">psi_p</span><span class="p">)</span>
<span class="linenos">18</span>        <span class="n">H_psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">anet</span><span class="o">.</span><span class="n">Launch</span><span class="p">()</span><span class="o">.</span><span class="n">get_block_</span><span class="p">()</span> <span class="c1"># get_block_ without copy</span>
<span class="linenos">19</span>
<span class="linenos">20</span>        <span class="n">H_psi</span><span class="o">.</span><span class="n">flatten_</span><span class="p">()</span>
<span class="linenos">21</span>        <span class="k">return</span> <span class="n">H_psi</span>
<span class="linenos">22</span>
<span class="linenos">23</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="k">def</span><span class="w"> </span><span class="nf">eig_Lanczos</span><span class="p">(</span><span class="n">psivec</span><span class="p">,</span> <span class="n">functArgs</span><span class="p">,</span> <span class="n">Cvgcrit</span><span class="o">=</span><span class="mf">1.0e-15</span><span class="p">,</span><span class="n">maxit</span><span class="o">=</span><span class="mi">100000</span><span class="p">):</span>
<span class="linenos">26</span><span class="w">    </span><span class="sd">&quot;&quot;&quot; Lanczos method for finding smallest algebraic eigenvector of linear \</span>
<span class="linenos">27</span><span class="sd">    operator defined as a function&quot;&quot;&quot;</span>
<span class="linenos">28</span>    <span class="c1">#print(eig_Lanczos)</span>
<span class="linenos">29</span>
<span class="linenos">30</span>    <span class="n">Hop</span> <span class="o">=</span> <span class="n">Projector</span><span class="p">(</span><span class="o">*</span><span class="n">functArgs</span><span class="p">,</span><span class="n">psivec</span><span class="o">.</span><span class="n">shape</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="n">psivec</span><span class="o">.</span><span class="n">dtype</span><span class="p">(),</span><span class="n">psivec</span><span class="o">.</span><span class="n">device</span><span class="p">())</span>
<span class="linenos">31</span>    <span class="n">gs_energy</span> <span class="p">,</span><span class="n">psivec</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">Lanczos</span><span class="p">(</span><span class="n">Hop</span><span class="p">,</span><span class="n">Tin</span><span class="o">=</span><span class="n">psivec</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;Gnd&quot;</span><span class="p">,</span><span class="n">CvgCrit</span><span class="o">=</span><span class="n">Cvgcrit</span><span class="p">,</span><span class="n">Maxiter</span><span class="o">=</span><span class="n">maxit</span><span class="p">)</span>
<span class="linenos">32</span>
<span class="linenos">33</span>    <span class="k">return</span> <span class="n">psivec</span><span class="p">,</span> <span class="n">gs_energy</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</pre></div>
</div>
<p>Now do the optimization and SVD task:</p>
<ul class="simple">
<li><p>In Python:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">psi</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">UniTensor</span><span class="p">(</span><span class="n">cytnx</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">rowrank</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">2</span><span class="n">shp</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span>
<span class="linenos">3</span><span class="n">psi_T</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">get_block_</span><span class="p">();</span> <span class="n">psi_T</span><span class="o">.</span><span class="n">flatten_</span><span class="p">()</span> <span class="c1">## flatten to 1d</span>
<span class="linenos">4</span><span class="n">psi_T</span><span class="p">,</span> <span class="n">Entemp</span> <span class="o">=</span> <span class="n">eig_Lanczos</span><span class="p">(</span><span class="n">psi_T</span><span class="p">,</span> <span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">R</span><span class="p">),</span> <span class="n">maxit</span><span class="o">=</span><span class="n">maxit</span><span class="p">);</span>
<span class="linenos">5</span><span class="n">psi_T</span><span class="o">.</span><span class="n">reshape_</span><span class="p">(</span><span class="o">*</span><span class="n">shp</span><span class="p">)</span>
<span class="linenos">6</span><span class="n">psi</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">UniTensor</span><span class="p">(</span><span class="n">psi_T</span><span class="p">,</span><span class="n">rowrank</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">7</span>
<span class="linenos">8</span><span class="n">s0</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">B</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">Svd_truncate</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span><span class="n">d</span><span class="p">))</span> <span class="c1">## Svd</span>
<span class="linenos">9</span><span class="n">s0</span><span class="o">/=</span><span class="n">s0</span><span class="o">.</span><span class="n">get_block_</span><span class="p">()</span><span class="o">.</span><span class="n">Norm</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="c1">## normalize</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>we are using a unit cell of two sites, however the unit cell can be any size, including a single site.</p>
</div>
<p>we performed SVD and use the left and right basis to update the environment for effective hamitonian, these procedure and network will always be the same in the future interations</p>
<a class="reference internal image-reference" href="../_images/idmrg_envupdate.png"><img alt="../_images/idmrg_envupdate.png" class="align-center" src="../_images/idmrg_envupdate.png" style="width: 470px;" />
</a>
<ul class="simple">
<li><p>In Python:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">anet</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s2">&quot;L_AMAH.net&quot;</span><span class="p">)</span>
<span class="linenos">2</span><span class="n">anet</span><span class="o">.</span><span class="n">PutUniTensors</span><span class="p">([</span><span class="s2">&quot;L&quot;</span><span class="p">,</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;A_Conj&quot;</span><span class="p">,</span><span class="s2">&quot;M&quot;</span><span class="p">],[</span><span class="n">L</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">A</span><span class="o">.</span><span class="n">Conj</span><span class="p">(),</span><span class="n">M</span><span class="p">]);</span>
<span class="linenos">3</span><span class="n">L</span> <span class="o">=</span> <span class="n">anet</span><span class="o">.</span><span class="n">Launch</span><span class="p">()</span>
<span class="linenos">4</span><span class="n">anet</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s2">&quot;R_AMAH.net&quot;</span><span class="p">)</span>
<span class="linenos">5</span><span class="n">anet</span><span class="o">.</span><span class="n">PutUniTensors</span><span class="p">([</span><span class="s2">&quot;R&quot;</span><span class="p">,</span><span class="s2">&quot;B&quot;</span><span class="p">,</span><span class="s2">&quot;B_Conj&quot;</span><span class="p">,</span><span class="s2">&quot;M&quot;</span><span class="p">],[</span><span class="n">R</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">B</span><span class="o">.</span><span class="n">Conj</span><span class="p">(),</span><span class="n">M</span><span class="p">]);</span>
<span class="linenos">6</span><span class="n">R</span> <span class="o">=</span> <span class="n">anet</span><span class="o">.</span><span class="n">Launch</span><span class="p">()</span>
</pre></div>
</div>
<p>we then solve the eigenvalue problem again and do SVD for the new effective hamitonian, note that we initialized a new random trial state here.</p>
<a class="reference internal image-reference" href="../_images/idmrg_n1.png"><img alt="../_images/idmrg_n1.png" class="align-center" src="../_images/idmrg_n1.png" style="width: 600px;" />
</a>
<ul class="simple">
<li><p>In Python:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1">## Construct n = 1</span>
<span class="linenos">2</span><span class="n">psi</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">UniTensor</span><span class="p">(</span><span class="n">cytnx</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">([</span><span class="n">d</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">d</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">rowrank</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">3</span><span class="n">shp</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span>
<span class="linenos">4</span><span class="n">psi_T</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">get_block_</span><span class="p">();</span> <span class="n">psi_T</span><span class="o">.</span><span class="n">flatten_</span><span class="p">()</span> <span class="c1">## flatten to 1d</span>
<span class="linenos">5</span><span class="n">psi_T</span><span class="p">,</span> <span class="n">Entemp</span> <span class="o">=</span> <span class="n">eig_Lanczos</span><span class="p">(</span><span class="n">psi_T</span><span class="p">,</span> <span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">R</span><span class="p">),</span> <span class="n">maxit</span><span class="o">=</span><span class="n">maxit</span><span class="p">);</span>
<span class="linenos">6</span><span class="n">psi_T</span><span class="o">.</span><span class="n">reshape_</span><span class="p">(</span><span class="o">*</span><span class="n">shp</span><span class="p">)</span>
<span class="linenos">7</span><span class="n">psi</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">UniTensor</span><span class="p">(</span><span class="n">psi_T</span><span class="p">,</span><span class="n">rowrank</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">8</span><span class="n">s1</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">B</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">Svd_truncate</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span><span class="n">d</span><span class="o">*</span><span class="n">d</span><span class="p">))</span>
<span class="linenos">9</span><span class="n">s1</span><span class="o">/=</span><span class="n">s1</span><span class="o">.</span><span class="n">get_block_</span><span class="p">()</span><span class="o">.</span><span class="n">Norm</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</pre></div>
</div>
<p>followed by another environment update:</p>
<ul class="simple">
<li><p>In Python:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># absorb A[1], B[1] to left &amp; right enviroment.</span>
<span class="linenos">2</span><span class="n">anet</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s2">&quot;L_AMAH.net&quot;</span><span class="p">)</span>
<span class="linenos">3</span><span class="n">anet</span><span class="o">.</span><span class="n">PutUniTensors</span><span class="p">([</span><span class="s2">&quot;L&quot;</span><span class="p">,</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;A_Conj&quot;</span><span class="p">,</span><span class="s2">&quot;M&quot;</span><span class="p">],[</span><span class="n">L</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">A</span><span class="o">.</span><span class="n">Conj</span><span class="p">(),</span><span class="n">M</span><span class="p">]);</span>
<span class="linenos">4</span><span class="n">L</span> <span class="o">=</span> <span class="n">anet</span><span class="o">.</span><span class="n">Launch</span><span class="p">()</span>
<span class="linenos">5</span><span class="n">anet</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s2">&quot;R_AMAH.net&quot;</span><span class="p">)</span>
<span class="linenos">6</span><span class="n">anet</span><span class="o">.</span><span class="n">PutUniTensors</span><span class="p">([</span><span class="s2">&quot;R&quot;</span><span class="p">,</span><span class="s2">&quot;B&quot;</span><span class="p">,</span><span class="s2">&quot;B_Conj&quot;</span><span class="p">,</span><span class="s2">&quot;M&quot;</span><span class="p">],[</span><span class="n">R</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">B</span><span class="o">.</span><span class="n">Conj</span><span class="p">(),</span><span class="n">M</span><span class="p">]);</span>
<span class="linenos">7</span><span class="n">R</span> <span class="o">=</span> <span class="n">anet</span><span class="o">.</span><span class="n">Launch</span><span class="p">()</span>
</pre></div>
</div>
<p>The next few steps involve “rotate” the center of our state to the left and right:</p>
<a class="reference internal image-reference" href="../_images/idmrg_rotate.png"><img alt="../_images/idmrg_rotate.png" class="align-center" src="../_images/idmrg_rotate.png" style="width: 500px;" />
</a>
<p>which is done by the straightforward contraction and re-SVD:</p>
<ul class="simple">
<li><p>In Python:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">A</span><span class="o">.</span><span class="n">set_rowrank_</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">2</span><span class="c1"># set the label &#39;_aux_R&#39; to another to avoid Svd error</span>
<span class="linenos">3</span><span class="n">sR</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">A</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">Svd</span><span class="p">(</span><span class="n">cytnx</span><span class="o">.</span><span class="n">Contract</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span><span class="o">.</span><span class="n">relabel_</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;-2&quot;</span><span class="p">))</span>
<span class="linenos">4</span><span class="n">B</span><span class="o">.</span><span class="n">set_rowrank_</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">5</span><span class="c1"># set the label &#39;_aux_L&#39; to another to avoid Svd error</span>
<span class="linenos">6</span><span class="n">sL</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">Svd</span><span class="p">(</span><span class="n">cytnx</span><span class="o">.</span><span class="n">Contract</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">relabel_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">))</span>
<span class="linenos">7</span><span class="n">A</span><span class="p">,</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span><span class="p">,</span><span class="n">A</span>
</pre></div>
</div>
<p>Note that we have discarded U for the rotate left case and Vt for the right, and now in this scheme we construct our trial state
for the n=2 iteration as follows, which looks like a inserted two new sites between our environment:</p>
<a class="reference internal image-reference" href="../_images/idmrg_trial.png"><img alt="../_images/idmrg_trial.png" class="align-center" src="../_images/idmrg_trial.png" style="width: 500px;" />
</a>
<p>and optimize this state:</p>
<a class="reference internal image-reference" href="../_images/idmrg_n2.png"><img alt="../_images/idmrg_n2.png" class="align-center" src="../_images/idmrg_n2.png" style="width: 600px;" />
</a>
<p>But where does that trial form come from? To gain more insight about it, we can instead consider the iTEBD approach here,
which is done by perform an evolution “gate” on the two sites:</p>
<a class="reference internal image-reference" href="../_images/idmrg_gate.png"><img alt="../_images/idmrg_gate.png" class="align-center" src="../_images/idmrg_gate.png" style="width: 350px;" />
</a>
<p>Suppose we didn’t even know what <span class="math notranslate nohighlight">\(s_n\)</span> looks like here, it’s just a <span class="math notranslate nohighlight">\(s_n\)</span>,
then we can simply follows the procedures mentioned in the iTEBD example, we have the following Vidal’s form for unit cell of two sites at n-th step:</p>
<a class="reference internal image-reference" href="../_images/idmrg_vidal.png"><img alt="../_images/idmrg_vidal.png" class="align-center" src="../_images/idmrg_vidal.png" style="width: 550px;" />
</a>
<p>this immediately suggests the above trial form if we try to rotate the center to the left and right and use translation symmetry.</p>
<p>The construction of trial state and optimization is done as follows:</p>
<ul class="simple">
<li><p>In Python:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">sR</span><span class="o">.</span><span class="n">relabel_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
<span class="linenos"> 2</span><span class="n">sL</span><span class="o">.</span><span class="n">relabel_</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="n">s0</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">s0</span>
<span class="linenos"> 4</span><span class="n">s0</span><span class="o">.</span><span class="n">relabels_</span><span class="p">([</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">])</span>
<span class="linenos"> 5</span><span class="n">s2</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">Contract</span><span class="p">(</span><span class="n">cytnx</span><span class="o">.</span><span class="n">Contract</span><span class="p">(</span><span class="n">sL</span><span class="p">,</span><span class="n">s0</span><span class="p">),</span><span class="n">sR</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="n">s2</span><span class="o">.</span><span class="n">relabels_</span><span class="p">([</span><span class="s2">&quot;-10&quot;</span><span class="p">,</span><span class="s2">&quot;-11&quot;</span><span class="p">])</span>
<span class="linenos"> 8</span><span class="n">A</span><span class="o">.</span><span class="n">relabel_</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;-10&quot;</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="n">B</span><span class="o">.</span><span class="n">relabel_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;-11&quot;</span><span class="p">)</span>
<span class="linenos">10</span><span class="n">psi</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">Contract</span><span class="p">(</span><span class="n">cytnx</span><span class="o">.</span><span class="n">Contract</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">s2</span><span class="p">),</span><span class="n">B</span><span class="p">)</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="c1">## optimize wave function:</span>
<span class="linenos">13</span><span class="c1">#  again use Lanczos to get the (local) ground state, the projector is in shape</span>
<span class="linenos">14</span><span class="n">shp</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span>
<span class="linenos">15</span><span class="n">psi_T</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">get_block_</span><span class="p">();</span> <span class="n">psi_T</span><span class="o">.</span><span class="n">flatten_</span><span class="p">()</span> <span class="c1">## flatten to 1d</span>
<span class="linenos">16</span><span class="n">psi_T</span><span class="p">,</span> <span class="n">Entemp</span> <span class="o">=</span> <span class="n">eig_Lanczos</span><span class="p">(</span><span class="n">psi_T</span><span class="p">,</span> <span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">R</span><span class="p">),</span> <span class="n">maxit</span><span class="o">=</span><span class="n">maxit</span><span class="p">);</span>
<span class="linenos">17</span><span class="n">psi_T</span><span class="o">.</span><span class="n">reshape_</span><span class="p">(</span><span class="o">*</span><span class="n">shp</span><span class="p">)</span>
<span class="linenos">18</span><span class="n">psi</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">UniTensor</span><span class="p">(</span><span class="n">psi_T</span><span class="p">,</span><span class="n">rowrank</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">19</span><span class="n">s2</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">B</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">Svd_truncate</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span><span class="n">psi</span><span class="o">.</span><span class="n">shape</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">psi</span><span class="o">.</span><span class="n">shape</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
<span class="linenos">20</span><span class="n">s2</span><span class="o">/=</span><span class="n">s2</span><span class="o">.</span><span class="n">get_block_</span><span class="p">()</span><span class="o">.</span><span class="n">Norm</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</pre></div>
</div>
<p>then we check the convergence by comparing the singular values to the one we obtained in the previous iteration:</p>
<ul class="simple">
<li><p>In Python:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">get_block_</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">s1</span><span class="o">.</span><span class="n">get_block_</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
<span class="linenos">2</span>    <span class="n">ss</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">3</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step:</span><span class="si">%d</span><span class="s2">, increasing bond dim!! dim: </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">s1</span><span class="o">.</span><span class="n">get_block_</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="n">chi</span><span class="p">))</span>
<span class="linenos">4</span><span class="k">else</span><span class="p">:</span>
<span class="linenos">5</span>    <span class="n">ss</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cytnx</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">get_block_</span><span class="p">(),</span><span class="n">s1</span><span class="o">.</span><span class="n">get_block_</span><span class="p">())</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="linenos">6</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step:</span><span class="si">%d</span><span class="s2">, diff:</span><span class="si">%11.11f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">ss</span><span class="p">))</span>
<span class="linenos">7</span><span class="k">if</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ss</span><span class="o">&lt;</span><span class="mf">1.0e-10</span><span class="p">):</span>
<span class="linenos">8</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[converge!!]&quot;</span><span class="p">)</span>
<span class="linenos">9</span>    <span class="k">break</span><span class="p">;</span>
</pre></div>
</div>
<p>also rememeber to update the environment using the SVD result.</p>
<ul class="simple">
<li><p>In Python:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">anet</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s2">&quot;L_AMAH.net&quot;</span><span class="p">)</span>
<span class="linenos"> 2</span><span class="n">anet</span><span class="o">.</span><span class="n">PutUniTensors</span><span class="p">([</span><span class="s2">&quot;L&quot;</span><span class="p">,</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;A_Conj&quot;</span><span class="p">,</span><span class="s2">&quot;M&quot;</span><span class="p">],[</span><span class="n">L</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">A</span><span class="o">.</span><span class="n">Conj</span><span class="p">(),</span><span class="n">M</span><span class="p">]);</span>
<span class="linenos"> 3</span><span class="n">L</span> <span class="o">=</span> <span class="n">anet</span><span class="o">.</span><span class="n">Launch</span><span class="p">()</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="n">anet</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s2">&quot;R_AMAH.net&quot;</span><span class="p">)</span>
<span class="linenos"> 6</span><span class="n">anet</span><span class="o">.</span><span class="n">PutUniTensors</span><span class="p">([</span><span class="s2">&quot;R&quot;</span><span class="p">,</span><span class="s2">&quot;B&quot;</span><span class="p">,</span><span class="s2">&quot;B_Conj&quot;</span><span class="p">,</span><span class="s2">&quot;M&quot;</span><span class="p">],[</span><span class="n">R</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">B</span><span class="o">.</span><span class="n">Conj</span><span class="p">(),</span><span class="n">M</span><span class="p">]);</span>
<span class="linenos"> 7</span><span class="n">R</span> <span class="o">=</span> <span class="n">anet</span><span class="o">.</span><span class="n">Launch</span><span class="p">()</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="n">s0</span> <span class="o">=</span> <span class="n">s1</span>
<span class="linenos">10</span><span class="n">s1</span> <span class="o">=</span> <span class="n">s2</span>
</pre></div>
</div>
<p>After reaching the fixed point, let’s consider a local measurement of energy for the final state:</p>
<a class="reference internal image-reference" href="../_images/idmrg_measure.png"><img alt="../_images/idmrg_measure.png" class="align-center" src="../_images/idmrg_measure.png" style="width: 350px;" />
</a>
<ul class="simple">
<li><p>In Python:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">H</span> <span class="o">=</span> <span class="n">J</span><span class="o">*</span><span class="n">cytnx</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">Kron</span><span class="p">(</span><span class="n">sz</span><span class="p">,</span><span class="n">sz</span><span class="p">)</span> <span class="o">+</span> <span class="n">Hx</span><span class="o">*</span><span class="p">(</span><span class="n">cytnx</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">Kron</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span><span class="n">eye</span><span class="p">)</span> <span class="o">+</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">Kron</span><span class="p">(</span><span class="n">eye</span><span class="p">,</span><span class="n">sx</span><span class="p">))</span>
<span class="linenos">2</span><span class="n">H</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">UniTensor</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">rowrank</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="c1"># use the converged state to get the local energy:</span>
<span class="linenos">5</span><span class="n">anet</span> <span class="o">=</span> <span class="n">cytnx</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s2">&quot;Measure.net&quot;</span><span class="p">)</span>
<span class="linenos">6</span><span class="n">anet</span><span class="o">.</span><span class="n">PutUniTensors</span><span class="p">([</span><span class="s2">&quot;psi&quot;</span><span class="p">,</span><span class="s2">&quot;psi_conj&quot;</span><span class="p">,</span><span class="s2">&quot;M&quot;</span><span class="p">],[</span><span class="n">psi</span><span class="p">,</span><span class="n">psi</span><span class="p">,</span><span class="n">H</span><span class="p">])</span>
<span class="linenos">7</span><span class="n">E</span> <span class="o">=</span> <span class="n">anet</span><span class="o">.</span><span class="n">Launch</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="linenos">8</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ground state E&quot;</span><span class="p">,</span><span class="n">E</span><span class="p">)</span>
</pre></div>
</div>
<div class="docutils container" id="id2">
<div role="list" class="citation-list">
<div class="citation" id="id3" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">PVM12</a><span class="fn-bracket">]</span></span>
<p>Ho N. Phien, Guifré Vidal, and Ian P. McCulloch. Infinite boundary conditions for matrix product state calculations. <em>Phys. Rev. B</em>, 86:245107, Dec 2012. URL: <a class="reference external" href="https://link.aps.org/doi/10.1103/PhysRevB.86.245107">https://link.aps.org/doi/10.1103/PhysRevB.86.245107</a>, <a class="reference external" href="https://doi.org/10.1103/PhysRevB.86.245107">doi:10.1103/PhysRevB.86.245107</a>.</p>
</div>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../CommApp.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Common usage</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="DMRG.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">3. </span>DMRG</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2019-, Kai-Hsin Wu
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">4. iDMRG</a><ul>
<li><a class="reference internal" href="#initialization">4.1. Initialization</a></li>
<li><a class="reference internal" href="#update-procedure">4.2. Update procedure</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>